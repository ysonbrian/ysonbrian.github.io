<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.e53586a225ffdde20c86.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 4.1.5"/><title data-react-helmet="true">Solidity를 이용한 가위바위보 게임</title><meta data-react-helmet="true" name="description" content="Solidity를 이용하여 가위바위보 게임을 만들어보고 개선 해보자!"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Solidity를 이용한 가위바위보 게임"/><meta data-react-helmet="true" property="og:description" content="Solidity를 이용하여 가위바위보 게임을 만들어보고 개선 해보자!"/><meta data-react-helmet="true" property="og:image" content="/static/a7c842e0f64983ca9f9e5086ee025333/block6.png"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="Solidity를 이용한 가위바위보 게임"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Solidity를 이용한 가위바위보 게임"/><meta data-react-helmet="true" name="twitter:description" content="Solidity를 이용하여 가위바위보 게임을 만들어보고 개선 해보자!"/><meta data-react-helmet="true" name="twitter:image" content="/static/a7c842e0f64983ca9f9e5086ee025333/block6.png"/><meta data-react-helmet="true" name="twitter:site" content="@ysonbrian"/><meta data-react-helmet="true" name="twitter:creator" content="@ysonbrian"/><meta data-react-helmet="true" name="google-site-verification" content="1mrcIHIWikoy30leLNzCtKxAQkfp6AAw8MVkI4qwy2Y"/><meta data-react-helmet="true" name="naver-site-verification" content="c887c1f5d091260e114972cdaab7043cd4b3fe25"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="canonical" href="https://ysonbrian.github.io/blockchain6/" data-baseprotocol="https:" data-basehost="ysonbrian.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-37d39448133db39d4e8c.js"/><link as="script" rel="preload" href="/framework-9215decd13501c1a6598.js"/><link as="script" rel="preload" href="/app-9d80546f4ed386aa4276.js"/><link as="script" rel="preload" href="/d0447323-d25faabaaafbdf301a36.js"/><link as="script" rel="preload" href="/1bfc9850-bb0c66b631c2c87d10ff.js"/><link as="script" rel="preload" href="/cb1608f2-5a24d9b1def76f733ade.js"/><link as="script" rel="preload" href="/d0dcf9c1039535d44ee74defc829dfbf62dac3c5-9a87cd5db49066e17f99.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-tsx-8d6b847d706dd06966ec.js"/><link as="fetch" rel="preload" href="/page-data/blockchain6/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 13ku56z">.css-13ku56z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}</style><main class="css-13ku56z e1tdc5110"><style data-emotion="css-global fmwae8">@import url('<https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap>');@import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:'Nanum Gothic',sans-serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css 16cz9yp">.css-16cz9yp{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-16cz9yp{height:300px;}}</style><div class="css-16cz9yp ek190do1"><style data-emotion="css 1bjn9yo">.css-1bjn9yo{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-1bjn9yo{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1bjn9yo ek190do0"><div style="max-width:1920px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;1920&#x27; width=&#x27;1920&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAADKUlEQVQ4y9WUXWibZRTHX6qIKDipLGmbz7dJnq+ka9Kk6Za0ZFuzNSVra9K11bbWiazRzbnYWGRbtbNuF4LTCwcbu5CBgpsDL7xwIOjwxirrxC92K4h45VD0RhH5Sd60a8e8Em92cXjOc97z/P//857nPJZSiv/TrDsXUEp5my/reymd9Tb/3wDXDmqtUUpijFz1G99ukmwg2AjsAK4F15KFENi2TSSi8AY0Pl8QpQRRIx0SB1hrpIygRXgdbPW8tVGukoJEIk5xzwiZdJhDkwEqs48gVAdub4NYS4G7M0dLfBfeeB9C6VtKt9RqKUZrPIF2MtltHHz2KMdmNVy9i4VaiW3JKK8+1YZXRljc2s2N6Uf5pbKPUmEKjzRE1bpKR6HWikAoQmr4MfyJXsqDA/zxxRG42szMcDNLlVaWTz+EVwlm4nG+LORZnu5nKL2VNh3H1MtdVWlJqdBKEYpIwqkcD/gV7587yV/fXOKtE3k+fMHH76ddfPKyh4+PBzgbyzCb7KG/f4DS+CSmK42p/0ttGgobXZVEt8Qw3RnKE3upHDrAExODFCfG+SDZxc+ju8mvXGD7Z+/w677dXM5m0cWH6SmM4O7opVl04U7sQGqDFdWS+9wdLI218Od7W3htoURuZJq3T7r5++u74cUWrpfLWN//iLV8jR/O9XE+0cPg/gRPP6ex1C66x2bZPlTCbg9hxYxkatTmyisPwnmLJ4ubGS8pfrq0Cb5t4sZigGupPKdeKvPGxUm+W9jJR9UYS2fSLL7eR1NhjvlKjcPDgw3ARKfgtyv3s/Kui0xvirGBEJ+/uQlW7oWvmjgxH+IeV4r5549wdGGeZ6pdlKpVYlMHmJnLc/lMkus7d/BpNo1Za8pE0SafC7M50EEyHqGQDXFsxsPSwTb29AcJC0O1VmOudpjHx9vZO1pGmh6Gcj5O7XdxPBmnmuh0Lr5Vv4N+W9MeUsS0QAiFHVa0+g0tXoMdaoyhx+OhzePFH9AEg0FnUuywxuUztAqBVwjq4qx6cr3LdasHnL2SzqhFzXrcGONYI7cx3zfzlHLKdRT+t2dqnfxW/054YP8B8I+cbGQskG8AAAAASUVORK5CYII=" alt=""/><picture><source type="image/webp" data-srcset="/static/a7c842e0f64983ca9f9e5086ee025333/b47e6/block6.webp 480w,/static/a7c842e0f64983ca9f9e5086ee025333/d2939/block6.webp 960w,/static/a7c842e0f64983ca9f9e5086ee025333/448ee/block6.webp 1920w" sizes="(min-width: 1920px) 1920px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1920px) 1920px, 100vw" decoding="async" loading="lazy" data-src="/static/a7c842e0f64983ca9f9e5086ee025333/e1ebd/block6.png" data-srcset="/static/a7c842e0f64983ca9f9e5086ee025333/fdfcd/block6.png 480w,/static/a7c842e0f64983ca9f9e5086ee025333/6641e/block6.png 960w,/static/a7c842e0f64983ca9f9e5086ee025333/e1ebd/block6.png 1920w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/a7c842e0f64983ca9f9e5086ee025333/b47e6/block6.webp 480w,/static/a7c842e0f64983ca9f9e5086ee025333/d2939/block6.webp 960w,/static/a7c842e0f64983ca9f9e5086ee025333/448ee/block6.webp 1920w" sizes="(min-width: 1920px) 1920px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 1920px) 1920px, 100vw" decoding="async" loading="lazy" src="/static/a7c842e0f64983ca9f9e5086ee025333/e1ebd/block6.png" srcSet="/static/a7c842e0f64983ca9f9e5086ee025333/fdfcd/block6.png 480w,/static/a7c842e0f64983ca9f9e5086ee025333/6641e/block6.png 960w,/static/a7c842e0f64983ca9f9e5086ee025333/e1ebd/block6.png 1920w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><style data-emotion="css m1156n">.css-m1156n{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:100%;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-m1156n{width:100%;padding:40px 20px;}}</style><div class="css-m1156n e1hgx18e3"><style data-emotion="css gywgo7">.css-gywgo7{display:grid;place-items:center;width:40px;height:40px;border-radius:50%;background:#ffffff;color:#000000;font-size:22px;cursor:pointer;box-shadow:0 0 10px rgba(0, 0, 0, 0.3);}@media (max-width: 768px){.css-gywgo7{width:30px;height:30px;font-size:18px;}}</style><div class="css-gywgo7 e1hgx18e2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg></div><style data-emotion="css gn4qtp">.css-gn4qtp{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin-top:auto;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-gn4qtp{font-size:30px;}}</style><div class="css-gn4qtp e1hgx18e1">Solidity를 이용한 가위바위보 게임</div><style data-emotion="css 3gcnt2">.css-3gcnt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-3gcnt2{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-3gcnt2 e1hgx18e0"><div>BlockChain</div><div>2021.12.11.</div></div></div></div><style data-emotion="css uo146q">.css-uo146q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0;word-break:break-all;line-height:1.8;font-size:16px;font-weight:400;}.css-uo146q p{padding:3px 0;}.css-uo146q h1,.css-uo146q h2,.css-uo146q h3{font-weight:800;margin-bottom:30px;}.css-uo146q *+h1,.css-uo146q *+h2,.css-uo146q *+h3{margin-top:80px;}.css-uo146q hr+h1,.css-uo146q hr+h2,.css-uo146q hr+h3{margin-top:0;}.css-uo146q h1{font-size:30px;}.css-uo146q h2{font-size:25px;}.css-uo146q h3{font-size:20px;}.css-uo146q blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}.css-uo146q ol,.css-uo146q ul{margin-left:20px;padding:30px 0;}.css-uo146q hr{border:1px solid #000000;margin:100px 0;}.css-uo146q a{color:#4263eb;-webkit-text-decoration:underline;text-decoration:underline;}.css-uo146q pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}.css-uo146q pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);border-radius:3px;}.css-uo146q code[class*='language-'],.css-uo146q pre[class*='language-']{tab-size:2;}@media (max-width: 768px){.css-uo146q{width:100%;padding:80px 20px;line-height:1.6;font-size:14px;}.css-uo146q h1{font-size:23px;}.css-uo146q h2{font-size:20px;}.css-uo146q h3{font-size:17px;}.css-uo146q img{width:100%;}.css-uo146q hr{margin:50px 0;}}</style><div class="css-uo146q e1rfwbgj0"><h1>Solidity를 이용한 가위바위보 게임</h1>
<hr>
<p>블록체인 네트워크에 우리가 작성한 스마트 컨트렉트를 보여주기 위해선 특수한 언어를 사용해야 하는데 이 언어는 어카운트 주소, 규칙 사양, 트랜잭션 되돌림과 같은 블록체인에 특화된 틍정 기능이 언어에 내장되어 있어야 합니다. 그렇다면 이것을 충족시켜주는 언어는 어떤게 있을까요?</p>
<h4>Solidity 특징</h4>
<ul>
<li>객체지향 고수준 언어이며 C++, 파이썬, 자바스크립트의 영향을 받았음</li>
<li>정적타입, 상속, 라이브러리, 사용자 정의 타입 등을 지원</li>
<li>블록체인 애플리케이션 개발을 위한 유용한 기능을 많이 제공</li>
</ul>
<p>오늘날 대부분의 스마트 컨트랙트는 Solidity를 사용 하고 있기 때문에 꼭 배워야 겠죠? 😉</p>
<p>오늘은 <strong>solidity</strong> 언어를 사용하여 간단한 가위바위보 게임을 만들어 보겠습니다.
가위바위보 게임을 만들기 위해선 스마트 컨트랙트 코드를 배포하고 테스트 해야 이더리움 네트워크에서 확인 할 수 있습니다.
여러 통합 개발 환경(Truffle, Ganache.. etc)이 있지만 Remix라는 통합 개발 환경을 이용해서 진행해 보겠습니다.</p>
<hr>
<h4>가위바위보 스마트 컨트랙트</h4>
<h5>게임방법</h5>
<p>스마트 컨트랙트를 처음 만든 사람이 방장이 되고 방장이 가위 바위 보 셋중에 하나의 값과 ether, gwei, 또는 wei 값을 컨트랙트에 저장하고 참가자도 마찬가지로 진행하고 둘중 이긴 사람이 컨트랙트에 담긴 모든 화폐를 가져가는 간단한 게임</p>
<p>모든 코드는 <a href="https://github.com/ysonbrian/block-smart-contract/blob/master/contract/RPS.sol" target="_blank" rel="nofollow">여기</a> 있습니다!</p>
<p>가위바위보 게임에서 가장 핵심적인 함수만 짚고 넘어가 보겠습니다 😁</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token keyword">function</span> <span class="token function">createRoom</span><span class="token punctuation">(</span>Hand _hand<span class="token punctuation">)</span>
    <span class="token keyword">public</span>
    <span class="token keyword">payable</span>
    <span class="token function">isValidHand</span><span class="token punctuation">(</span>_hand<span class="token punctuation">)</span>
    <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span> roomNum<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 컨트랙트를 만든 사람이 게임 주인이며 컨트랙트를 생성과 동시에 자신의 가위바위보를 하나 설정하여 컨트랙트에 저장!</span>
    rooms<span class="token punctuation">[</span>roomLen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Game</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      betAmount<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token comment">// 이 게임에 배팅한 총 금액 ... 처음엔 방장이 돈을 넣는다</span>
      gameStatus<span class="token punctuation">:</span> GameStatus<span class="token punctuation">.</span>STATUS_NOT_STRTED<span class="token punctuation">,</span> <span class="token comment">// 게임 상태</span>
      originator<span class="token punctuation">:</span> <span class="token function">Player</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// originator는 스마트 컨트랙트를 처음 만든 이 게임의 주인을 나타냄</span>
        hand<span class="token punctuation">:</span> _hand<span class="token punctuation">,</span> <span class="token comment">// 가위 바위 보 셋중 하나</span>
        addr<span class="token punctuation">:</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 방장 어카운트 주소</span>
        playerStatus<span class="token punctuation">:</span> PlayerStatus<span class="token punctuation">.</span>STATUS_PENDING<span class="token punctuation">,</span> <span class="token comment">// 방장 상태</span>
        playerBetAmount<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>value <span class="token comment">// 방장이 낸 금액</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      taker<span class="token punctuation">:</span> <span class="token function">Player</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// taker는 참여자를 나타냄</span>
        hand<span class="token punctuation">:</span> Hand<span class="token punctuation">.</span>rock<span class="token punctuation">,</span> <span class="token comment">// 디폴트로 참여자 정보를 세팅</span>
        addr<span class="token punctuation">:</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 초기 세팅은 방장의 주소.. 참여자가 참여하면 바뀜</span>
        playerStatus<span class="token punctuation">:</span> PlayerStatus<span class="token punctuation">.</span>STATUS_PENDING<span class="token punctuation">,</span> <span class="token comment">// 참여자의 상태</span>
        playerBetAmount<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment">// 참여자가 없기때문에 초기 값은 0</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    roomNum <span class="token operator">=</span> roomLen<span class="token punctuation">;</span>
    roomLen <span class="token operator">=</span> roomLen <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 방은 여러개가 생성 될 수 있기 때문에 방 생성시 자동으로 증가</span>
  <span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token keyword">function</span> <span class="token function">joinRoom</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> roomNum<span class="token punctuation">,</span> Hand _hand<span class="token punctuation">)</span>
    <span class="token keyword">public</span>
    <span class="token keyword">payable</span>
    <span class="token function">isValidHand</span><span class="token punctuation">(</span>_hand<span class="token punctuation">)</span> <span class="token comment">// 참여자의 가위 바위 보 값을 확인</span>
  <span class="token punctuation">{</span>
    rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker <span class="token operator">=</span> <span class="token function">Player</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 실질적으로 참여자가 게임에 참여 하면서 정보가 담김</span>
      hand<span class="token punctuation">:</span> _hand<span class="token punctuation">,</span> <span class="token comment">// 가위 바위 보</span>
      addr<span class="token punctuation">:</span> <span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 참여자 주소</span>
      playerStatus<span class="token punctuation">:</span> PlayerStatus<span class="token punctuation">.</span>STATUS_PENDING<span class="token punctuation">,</span> <span class="token comment">// 참여자 상태</span>
      playerBetAmount<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>value <span class="token comment">// 참여자의 배팅 금액</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>betAmount <span class="token operator">=</span> rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>betAmount <span class="token operator">+</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 참여가 완료 되면 게임방의 배팅 금액에 참여자 배팅을 더함</span>
    <span class="token function">compareHands</span><span class="token punctuation">(</span>roomNum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 방장과 참여자의 결과를 확인</span>
  <span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token keyword">function</span> <span class="token function">compareHands</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> roomNum<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint8</span> originator <span class="token operator">=</span> <span class="token builtin">uint8</span><span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>hand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 방장이 낸 가위 바위 보 값을 확인</span>
    <span class="token builtin">uint8</span> taker <span class="token operator">=</span> <span class="token builtin">uint8</span><span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>hand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 참여자의 가위 바위 보 값을 확인</span>

    rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>gameStatus <span class="token operator">=</span> GameStatus<span class="token punctuation">.</span>STATUS_STARTED<span class="token punctuation">;</span> <span class="token comment">// 게임이 시작함을 알림</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>taker <span class="token operator">==</span> originator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 비긴 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_TIE<span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_TIE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>taker <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> originator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 방장이 이긴 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_WIN<span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_LOSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>originator <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> taker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 참가자가 이긴 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_LOSE<span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_WIN<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 그 외의 상황에는 게임 상태를 에러로 업데이트한다</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>gameStatus <span class="token operator">=</span> GameStatus<span class="token punctuation">.</span>STATUS_ERROR<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">modifier</span> <span class="token function">isPlayer</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> roomNum<span class="token punctuation">,</span> <span class="token builtin">address</span> sender<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 방장 또는 참여자의 주소가 맞는지 확인</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>
      sender <span class="token operator">==</span> rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>addr <span class="token operator">||</span>
        sender <span class="token operator">==</span> rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>addr
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">_</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token keyword">function</span> <span class="token function">payout</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> roomNum<span class="token punctuation">)</span> <span class="token comment">// 게임 결과를 확인하고 배팅을 정산</span>
    <span class="token keyword">public</span>
    <span class="token keyword">payable</span>
    <span class="token function">isPlayer</span><span class="token punctuation">(</span>roomNum<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token comment">// 비기는 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">==</span> PlayerStatus<span class="token punctuation">.</span>STATUS_TIE <span class="token operator">&amp;&amp;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">==</span> PlayerStatus<span class="token punctuation">.</span>STATUS_TIE
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>addr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>
        rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerBetAmount
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>addr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerBetAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">==</span> PlayerStatus<span class="token punctuation">.</span>STATUS_WIN<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 방장이 이기는 경우</span>
        rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>addr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>betAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">==</span> PlayerStatus<span class="token punctuation">.</span>STATUS_WIN<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 참여자가 이기는 경우</span>
        rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>addr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>betAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 둘다 아닌경우</span>
        rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>addr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>
          rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerBetAmount
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>addr<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>
          rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerBetAmount
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>gameStatus <span class="token operator">=</span> GameStatus<span class="token punctuation">.</span>STATUS_COMPLETE<span class="token punctuation">;</span> <span class="token comment">// 게임이 종료되었으므로 게임 상태 변경</span>
  <span class="token punctuation">}</span></code></pre></div>
<hr>
<h3>가위바위보 게임 실행</h3>
<ol>
<li>
<p>방을 만든다</p>
<p><img src="/9055ce023d5864e686b1d0099d991361/createRoom.gif" alt="">
방장은 게임방을 생성하고 가위 바위 보 값중에 하나를 넣는다. 이 예시 에서는 주먹을 넣었고 추가로 10 이더 값을 넣었다</p>
</li>
<li>
<p>참여자 입장
<img src="/6f10982f91cdec61bbb3c2288839e761/playerEnter.gif" alt="playerEnter">
첫 방을 생성하면 0 번째 부터 시작하기 때문에 0 값을 넣어주고 방장을 이기는 조건으로 바위와 10 이더를 함께 트랜잭션을 해주었다</p>
</li>
<li>
<p>결과 확인
<img src="/dd4211cb98b795dfd99df264645271ed/endGame.gif" alt="endGame">
방장이 payout을 누르면 결과값을 확인 할 수 있는데 이 예시에서는 참여자가 이기는 조건으로 진행 했기 때문에 2번째 어카운트에 20 이더가 추가 된 것을 확인했다.</p>
</li>
</ol>
<h4>잠깐! 뭔가 문제가 있는데?😱</h4>
<p><img src="/e9fe5975d9c72d20c48346d887058bb8/canSee.gif" alt="canSee">
롭스텐에 배포후 방장이 낸 가위 바위 정보를 확인 할 수 있다니..?? 이러면 참여자가 무조건 이기는 게임이 된다!!</p>
<h3>심각한 오류를 발견! 개선 해보자! 🧑🏻‍💻</h3>
<p>모든 스마트 컨트랙트는 블록체인 네트워크에 올라가면 모든 정보를 누구나 볼 수 있기 때문에 보안을 무조건 신경 써주어야 하는데 우리가 만든 가위바위보의 게임은 방장의 선택을 누구나 확인 할 수 있기 때문에 방장의 돈을 무조건 가져갈 수 있는 게임이 되었다.
정보를 감추기 위해 고민을 해보았고 여러 리서치를 통해 한가지 방법을 찾을 수 있었다. Solidity에서 제공하는 <strong>keccak256</strong>이라는 함수는 데이터의 값을 해시로 암호화 하여 고정된 값으로 바꿔주는데 이 값을 바이트 값으로 바꿔주면 블록체인 네트워크에 올라가도 바이트값으로 나오기 때문에 참여자가 어떤 값인지 확인 할 수가 없다.</p>
<p>Keccak256 함수에 abi.encodePacked(first, second)를 넣어주면 데이터 값을 해시화 하여 리턴 해주는데 first 와 second 값은 string, bytes 또는 uint 자료형으로 구성해야 하며 각 값중에 하나는 감추고 싶은 데이터와 다른 값은 랜덤한 값을 넣어주면 기본 해시 + salt**(Brute Force Attack (무작위 공격**)을 예방하여 기본 해시값에 다른 랜덤 값을 더해주는 개념) 하여 암호화 할 수 있다. Solidty 공식 사이트에서는 만약 first 와 second 값이 ‘A’ + ‘BB’ 이거나 ‘AB’ + ‘B’ 이라면 동일한 값을 리턴한다고 하여 사용하는데 주의 하라 하였지만 방장은 처음 게임을 만들때 가위바위보 값이 아닌 해쉬된 값을 넣고 만들면 참여자는 방장의 2번째 값을 알 수 없기 때문에 괜찮다고 생각했다.</p>
<p>개선된 코드는 <a href="https://github.com/ysonbrian/block-smart-contract/blob/master/contract/rpsAdvanced.sol" target="_blank" rel="nofollow">여기</a> 있습니다!</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token keyword">function</span> <span class="token function">hashFunction</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _hand<span class="token punctuation">,</span> <span class="token builtin">string</span> <span class="token keyword">memory</span> _secret<span class="token punctuation">)</span>
    <span class="token keyword">public</span>
    <span class="token keyword">pure</span>
    <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>_hand<span class="token punctuation">,</span> _secret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 해시된 바이트값</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>가위바위보 게임을 처음 디플로이 하면 방장은 hashFunction을 사용하여 핸드 값과 개인 비밀값을 넣어서 반환된 byte 값을 게임 생성할때 값으로 넣어준다.</p>
<div class="gatsby-highlight" data-language="solidity"><pre class="language-solidity"><code class="language-solidity"><span class="token keyword">function</span> <span class="token function">compareHands</span><span class="token punctuation">(</span>
    <span class="token builtin">uint256</span> roomNum<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> _hand<span class="token punctuation">,</span>
    <span class="token builtin">string</span> <span class="token keyword">memory</span> _secret
  <span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> originator<span class="token punctuation">;</span>
    <span class="token builtin">uint256</span> taker<span class="token punctuation">;</span>
    <span class="token builtin">bytes32</span> validateHand <span class="token operator">=</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>_hand<span class="token punctuation">,</span> _secret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 방장은 결과를 확인하기 위해 처음에 입력했던 값들을 넣어준다</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span> <span class="token comment">// 방장이 다른값을 넣을 수 없도록 입력된 값이 처음 생성됐을때 값과 같은지 확인</span>
      validateHand <span class="token operator">==</span> rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>hand<span class="token punctuation">,</span>
      <span class="token string">'Creator Must submit right hand and secret'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    originator <span class="token operator">=</span> _hand<span class="token punctuation">;</span>
    taker <span class="token operator">=</span> <span class="token builtin">uint8</span><span class="token punctuation">(</span>rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>hand<span class="token punctuation">)</span><span class="token punctuation">;</span>

    rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>gameStatus <span class="token operator">=</span> GameStatus<span class="token punctuation">.</span>STATUS_STARTED<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>taker <span class="token operator">==</span> originator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 비긴 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_TIE<span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_TIE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>taker <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> originator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 방장이 이긴 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_WIN<span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_LOSE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>originator <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> taker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 참가자가 이긴 경우</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_LOSE<span class="token punctuation">;</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>playerStatus <span class="token operator">=</span> PlayerStatus<span class="token punctuation">.</span>STATUS_WIN<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 그 외의 상황에는 게임 상태를 에러로 업데이트한다</span>
      rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>gameStatus <span class="token operator">=</span> GameStatus<span class="token punctuation">.</span>STATUS_ERROR<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">modifier</span> <span class="token function">isPlayer</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> roomNum<span class="token punctuation">,</span> <span class="token builtin">address</span> sender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>
      sender <span class="token operator">==</span> rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>originator<span class="token punctuation">.</span>addr <span class="token operator">||</span>
        sender <span class="token operator">==</span> rooms<span class="token punctuation">[</span>roomNum<span class="token punctuation">]</span><span class="token punctuation">.</span>taker<span class="token punctuation">.</span>addr
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">_</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div>
<p>기존 compareHands 함수는 참여자가 joinRoom 함수를 실행 할때 마지막에 실행 됐지만, 이 함수를 방장이 결괏값을 확인할 때 실행 하면서 게임의 결과를 확인하도록 바꾸었다.
require 구문을 사용하여 방장이 마음이 바뀌어 다른값을 입력해도 초기에 입력한 값으로만 게임이 진행하도록 구현하였고 게임은 문제 없이 진행 할 수 있다.</p>
<p><img src="/51f9163df4010de2a7401ddffcc32a58/advancedCreateRoom.gif" alt="advancedCreateRoom">
방장이 처음 방을 만들면 hashFunction을 사용하여 가위 바위 보 값과 비밀값을 넣어주면 해시값을 얻을 수 있고 이 값을 그대로 createRoom 값에 넣어준다.
<img src="/175540e8aa5e4f56a077d367aa0ee7d6/advancedPlayerEnter.gif" alt="advancedPlayerEnter">
참여자는 전 과 동일하게 값을 넣어준다.
<img src="/97ba447893f6c9caa01503aa7c52bee8/advancedEndGame.gif" alt="advancedEndGame">
방장이 payout 함수를 실행 할 때 처음에 입력했던 값을 그대로 넣어야만 게임이 끝이 난다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c7c8d38d573358615b76fa258f624dfa/64865/errorSituation.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 31.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9klEQVQY032RW27CMBBFs5RCHn7EdlIgUCBxHkBUVapgAf3o/jdxKqelqGrpx9Gdj5kjjycyruNxOeIWI7o8okxLbluU6bFFjzYNcVrxMFt9M5tXd4mkqnGLE1195tVfKFyPcT26OKDLHpU3SN2gtEflHqlrUrG7S5TbDpF72uXIuz9T2A6Vt1g3YIthkoSeK9q002D2xS+hKwdW62dMeUC5ASG2qGRDkm1J0ieS9Jo30mxLlu2mnGpxq6OwTnjJan+hOr0htEfIPUo3SBWoJ0JznGyYx+t/icJ/haMsNi8s92ek9hjbYWz/I4NUyE9xGAwH+Ev4AUoluqJ/VPKkAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/c7c8d38d573358615b76fa258f624dfa/a59e9/errorSituation.webp 192w,
/static/c7c8d38d573358615b76fa258f624dfa/0ca9f/errorSituation.webp 384w,
/static/c7c8d38d573358615b76fa258f624dfa/dc9b9/errorSituation.webp 768w,
/static/c7c8d38d573358615b76fa258f624dfa/e2c2f/errorSituation.webp 1152w,
/static/c7c8d38d573358615b76fa258f624dfa/f3efb/errorSituation.webp 1536w,
/static/c7c8d38d573358615b76fa258f624dfa/65424/errorSituation.webp 2726w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/c7c8d38d573358615b76fa258f624dfa/3b721/errorSituation.png 192w,
/static/c7c8d38d573358615b76fa258f624dfa/66595/errorSituation.png 384w,
/static/c7c8d38d573358615b76fa258f624dfa/fe486/errorSituation.png 768w,
/static/c7c8d38d573358615b76fa258f624dfa/d2d74/errorSituation.png 1152w,
/static/c7c8d38d573358615b76fa258f624dfa/e8464/errorSituation.png 1536w,
/static/c7c8d38d573358615b76fa258f624dfa/64865/errorSituation.png 2726w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/c7c8d38d573358615b76fa258f624dfa/fe486/errorSituation.png"
            alt="errorSituation"
            title="errorSituation"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
기존 값이 아닌 값을 입력하면 “Creator Must submit right hand and secret” 이라는 문구를 보여주며 실패하게 된다</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/241eba06849ecefa12026af5d96c820c/434e6/result.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABj0lEQVQ4y4VT2W7jMAz0//9dnxfYotiHTR3b0UVS9ywoBW2TJlsBA9GWNBqOyOVsCeth4UNAyhW5FORSUe5R5zzX75ALJCawRCxJInLw6BTQmdFbQ9PDeW4sZULjWiuejVobJGYszAwKYW7uQOsdOwUEIjALRARENKBx7/0bJmEdKhfrPJR0jN4H4RoY1nuEEFByxrjpyfgkbJNQJCKl9LGoCJxgg8CSjFm9xQNlDxXyNY2rwBEfnnFwhUkdhzRcpCDWcnPpd8KrQmL5TPl6wFkL7x1ySmitPiV6SOh9gDFmSNa11jrO24bT6R3btsN5f/O6P6ZMxMP8GOOHT/ptrRn/WBgxJaRchtc/p0wM7+dL92kivN2wbyeYy4qL2bA7h9UYvF8OOOH/1GHCEohHfX0tgZgynPNwPsAHGl3StOBbGwf1W+ev0I4ZhCll1FJuPPr1+w3reQcxQ+vUWjfINdaLNCMVMm3IAypiEpaG0uZjTAUVr29/sBsHKR2cKiiW2S0scLHi5S+j1Dba9N7Df0Qk+3Ps4hOiAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/241eba06849ecefa12026af5d96c820c/a59e9/result.webp 192w,
/static/241eba06849ecefa12026af5d96c820c/0ca9f/result.webp 384w,
/static/241eba06849ecefa12026af5d96c820c/dc9b9/result.webp 768w,
/static/241eba06849ecefa12026af5d96c820c/e2c2f/result.webp 1152w,
/static/241eba06849ecefa12026af5d96c820c/f3efb/result.webp 1536w,
/static/241eba06849ecefa12026af5d96c820c/cb922/result.webp 2972w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/241eba06849ecefa12026af5d96c820c/3b721/result.png 192w,
/static/241eba06849ecefa12026af5d96c820c/66595/result.png 384w,
/static/241eba06849ecefa12026af5d96c820c/fe486/result.png 768w,
/static/241eba06849ecefa12026af5d96c820c/d2d74/result.png 1152w,
/static/241eba06849ecefa12026af5d96c820c/e8464/result.png 1536w,
/static/241eba06849ecefa12026af5d96c820c/434e6/result.png 2972w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/241eba06849ecefa12026af5d96c820c/fe486/result.png"
            alt="result"
            title="result"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
롭스텐에 직접 배포하여 확인해보니 역시나 바이트값으로 잘 감춰진 것을 확인 할 수가 있었다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2c7e3a5c682d9adc6ff4613f003b30e2/f021b/gameResult.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz32SgW7DIAxE+/8fOnVTUxWMbcDATUCSZVkzpBOKMI/zObeHU3jnQc8nhAjFDA3Xq7WGWusbNWQz3CILxDlUEbQY0WpFSgkqChGBqu4SUZRSdnBrWDUtdOgtMENUd1d9/5IArxMWY4JqXIFyAv5oB3rvkXP+VeQ0wVMAURhuu+tz22foDmSWcelYEDTBBYXnCBdkfM9Ls8f2Visw9twOL/b19IL7S3APhg8q+CTDQxI4F5Q6wZctp5THlLZw+1HPijmg1AqrbUByqYhWJ/A/h0SEQHSYWsPr5bAsC3q+zLw72Mb2rmVsQM86MzpkyCLwnhACwxMNx+0yu1PLkgySCszK+CWs9L3+ka1nV+o12Qq+AVEqE6IrnnBeAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2c7e3a5c682d9adc6ff4613f003b30e2/a59e9/gameResult.webp 192w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/0ca9f/gameResult.webp 384w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/dc9b9/gameResult.webp 768w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/e2c2f/gameResult.webp 1152w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/f3efb/gameResult.webp 1536w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/d0d90/gameResult.webp 2760w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/2c7e3a5c682d9adc6ff4613f003b30e2/3b721/gameResult.png 192w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/66595/gameResult.png 384w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/fe486/gameResult.png 768w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/d2d74/gameResult.png 1152w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/e8464/gameResult.png 1536w,
/static/2c7e3a5c682d9adc6ff4613f003b30e2/f021b/gameResult.png 2760w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2c7e3a5c682d9adc6ff4613f003b30e2/fe486/gameResult.png"
            alt="gameResult"
            title="gameResult"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
참여자가 200 wei로 참여하고 게임을 승리하여 300wei를 돌려 받았다.</p>
<h4><a href="https://ropsten.etherscan.io/address/0x523d10ace8773ce9fc1bebc2f3e811fdcb9cdf73" target="_blank" rel="nofollow">컨트랙트주소</a> 를 확인할 수 있다</h4>
<hr>
<h2>마치며</h2>
<p>가위바위보 라는 간단한 게임을 직접 스마트 컨트랙트로 작성하고 배포 해보았는데 스마트 컨트랙트가 블록체인에 올라가게 되면 작성한 코드를 바꿀 수 없기 때문에 배포하기 전에 많은 테스트를 거치고 보완점을 찾고 배포해야만 한다. 일반 웹게임처럼 게임하면 지고 끝나는게 아니라 개인의 돈을 지불 하기 때문에 코드를 좀 더 정교하게 짜고 배포해야 다른 해커로부터 위험을 방지 할 수가 있다. 보안이 중요시 되는 값들을 잘 관리하여 배포하고 그렇다고 많은 데이터를 스마트 컨트랙트에 담게 되면 그만큼 가스 소비가 크기 때문에 코드를 최적화 하는 것도 잊지 말아야 한다. 이 게임은 오직 방장만이 payout을 실행하여 금액을 배분하는 구조 이지만, 만약 방장이 악의적인 마음을 가지고 참여자의 값을 확인하고 본인이 불리하면 실행하지 않게 되면 이 컨트랙트 안에 있는 돈은 영원히 묵히게 되므로 방장만 실행하는 것이 아니라 참여자가 결과를 확인하는 방법도 시도해볼만 하다. 또한 참여자의 값도 해시화 하여 방장도 확인 못하게 하면 굳이 마지막 참여자가 결과를 확인 안하더라도 방장도 궁금해서 확인하지 않을까 한다. 다음에 이런 비슷한 게임이나 다른 것을 만들때는 이부분을 생각하여 더 나은 스마트 컨트랙트를 만들어 봐야겠다.</p></div><style data-emotion="css hx9xpc">@media (max-width: 768px){.css-hx9xpc{padding:0 20px;}}</style><div class="css-hx9xpc e16eukfd0"></div><style data-emotion="css 9w9jmx">.css-9w9jmx{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-9w9jmx{font-size:13px;}}</style><footer class="css-9w9jmx e1ixtmvx1"><style data-emotion="css 1blll3s">.css-1blll3s{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:10px;list-style:none;}</style><ul class="css-1blll3s e1ixtmvx0"><li><a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;to=ysonbrian@gmail.com" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"></path></svg></a></li><li><a href="https://github.com/ysonbrian" target="_blank"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li></ul><br/><div> ©Youngduk Son • 2021</div></footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blockchain6/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-82288028afbb6702cc73.js"],"app":["/app-9d80546f4ed386aa4276.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-96abd5f7a5b204c42ad6.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-996cb922549953ee36f8.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-8d6b847d706dd06966ec.js"]};/*]]>*/</script><script src="/polyfill-82288028afbb6702cc73.js" nomodule=""></script><script src="/component---src-templates-post-template-tsx-8d6b847d706dd06966ec.js" async=""></script><script src="/d0dcf9c1039535d44ee74defc829dfbf62dac3c5-9a87cd5db49066e17f99.js" async=""></script><script src="/cb1608f2-5a24d9b1def76f733ade.js" async=""></script><script src="/1bfc9850-bb0c66b631c2c87d10ff.js" async=""></script><script src="/d0447323-d25faabaaafbdf301a36.js" async=""></script><script src="/app-9d80546f4ed386aa4276.js" async=""></script><script src="/framework-9215decd13501c1a6598.js" async=""></script><script src="/webpack-runtime-37d39448133db39d4e8c.js" async=""></script></body></html>